/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=r(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){s=!0,a=t},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw a}}}}function r(t,e){if(t){if("string"==typeof t)return n(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,i(n.key),n)}}function i(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}var a=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]},i=[{key:"bindToDOM",value:function(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}},{key:"drawUi",value:function(t){var e,r,n,o,i=this;this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",(function(t){return i.onNewGameClick(t)})),this.saveGameEl.addEventListener("click",(function(t){return i.onSaveGameClick(t)})),this.loadGameEl.addEventListener("click",(function(t){return i.onLoadGameClick(t)})),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(var a=0;a<Math.pow(this.boardSize,2);a+=1){var c=document.createElement("div");c.classList.add("cell","map-tile","map-tile-".concat((void 0,void 0,o=(e=a)%(r=this.boardSize),0===(n=Math.floor(e/r))?0===o?"top-left":o===r-1?"top-right":"top":n===r-1?0===o?"bottom-left":o===r-1?"bottom-right":"bottom":0===o?"left":o===r-1?"right":"center"))),c.addEventListener("mouseenter",(function(t){return i.onCellEnter(t)})),c.addEventListener("mouseleave",(function(t){return i.onCellLeave(t)})),c.addEventListener("click",(function(t){return i.onCellClick(t)})),this.boardEl.appendChild(c)}this.cells=Array.from(this.boardEl.children)}},{key:"redrawPositions",value:function(t){var r,n=e(this.cells);try{for(n.s();!(r=n.n()).done;)r.value.innerHTML=""}catch(t){n.e(t)}finally{n.f()}var o,i,a=e(t);try{for(a.s();!(o=a.n()).done;){var c=o.value,s=this.boardEl.children[c.position],l=document.createElement("div");l.classList.add("character",c.character.type);var u=document.createElement("div");u.classList.add("health-level");var f=document.createElement("div");f.classList.add("health-level-indicator","health-level-indicator-".concat((i=c.character.health)<15?"critical":i<50?"normal":"high")),f.style.width="".concat(c.character.health,"%"),u.appendChild(f),l.appendChild(u),s.appendChild(l)}}catch(t){a.e(t)}finally{a.f()}}},{key:"addCellEnterListener",value:function(t){this.cellEnterListeners.push(t)}},{key:"addCellLeaveListener",value:function(t){this.cellLeaveListeners.push(t)}},{key:"addCellClickListener",value:function(t){this.cellClickListeners.push(t)}},{key:"addNewGameListener",value:function(t){this.newGameListeners.push(t)}},{key:"addSaveGameListener",value:function(t){this.saveGameListeners.push(t)}},{key:"addLoadGameListener",value:function(t){this.loadGameListeners.push(t)}},{key:"onCellEnter",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onCellLeave",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onCellClick",value:function(t){var e=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onNewGameClick",value:function(t){t.preventDefault(),this.newGameListeners.forEach((function(t){return t.call(null)}))}},{key:"onSaveGameClick",value:function(t){t.preventDefault(),this.saveGameListeners.forEach((function(t){return t.call(null)}))}},{key:"onLoadGameClick",value:function(t){t.preventDefault(),this.loadGameListeners.forEach((function(t){return t.call(null)}))}},{key:"selectCell",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(t),this.cells[t].classList.add("selected","selected-".concat(e))}},{key:"deselectCell",value:function(t){var e,o=this.cells[t];(e=o.classList).remove.apply(e,function(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||r(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(Array.from(o.classList).filter((function(t){return t.startsWith("selected")}))))}},{key:"showCellTooltip",value:function(t,e){this.cells[e].title=t}},{key:"hideCellTooltip",value:function(t){this.cells[t].title=""}},{key:"showDamage",value:function(t,e){var r=this;return new Promise((function(n){var o=r.cells[t],i=document.createElement("span");i.textContent=e,i.classList.add("damage"),o.appendChild(i),i.addEventListener("animationend",(function(){o.removeChild(i),n()}))}))}},{key:"setCursor",value:function(t){this.boardEl.style.cursor=t}},{key:"checkBinding",value:function(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}],a=[{key:"showError",value:function(t){alert(t)}},{key:"showMessage",value:function(t){alert(t)}}],i&&o(t.prototype,i),a&&o(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,i,a}();const c={prairie:"prairie",desert:"desert",arctic:"arctic",mountain:"mountain"};function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,u(n.key),n)}}function u(t){var e=function(t){if("object"!=s(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==s(e)?e:e+""}var f=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.isPlayerTurn=!0,this.isGameOver=!1,this.selectedCharacter=[],this.level=1,this.allPositions=[],this.score=0,this.statistics=[],this.selected=null},e=[{key:"from",value:function(t){return"object"===s(t)?t:null}}],null&&l(t.prototype,null),e&&l(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,p(n.key),n)}}function p(t){var e=function(t){if("object"!=h(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=h(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==h(e)?e:e+""}var m=function(){return t=function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"generic";if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.level=e,this.attack=0,this.defence=0,this.health=50,this.type=r,(this instanceof t?this.constructor:void 0)===t)throw new Error("The base class cannot be used to create a character")},(e=[{key:"levelUp",value:function(){this.level+=1,this.attack=Math.floor(Math.max(this.attack,this.attack*(80+this.health)/100)),this.attack>100&&(this.attack=80),this.defence=Math.floor(Math.max(this.defence,this.defence*(80+this.health)/100)),this.defence>100&&(this.defence=80),this.health+=80,this.health>100&&(this.health=100)}}])&&y(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function d(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,g(n.key),n)}}function b(t,e,r){return e&&d(t.prototype,e),r&&d(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function g(t){var e=function(t){if("object"!=v(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=v(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==v(e)?e:e+""}var w=b((function t(e,r){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!(e instanceof m))throw new Error("character must be instance of Character or its children");if("number"!=typeof r)throw new Error("position must be a number");this.character=e,this.position=r}));function S(t){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S(t)}function P(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function k(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,E(n.key),n)}}function E(t){var e=function(t){if("object"!=S(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=S(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==S(e)?e:e+""}var O=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.characters=new Set},e=[{key:"add",value:function(t){if(this.characters.has(t))throw new Error("Такой персонаж уже добавлен");this.characters.add(t)}},{key:"addAll",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];r.forEach((function(e){return t.characters.add(e)}))}},{key:"delete",value:function(t){this.characters.delete(t)}},{key:"toArray",value:function(){return function(t){return function(t){if(Array.isArray(t))return P(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return P(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?P(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.characters)}}],e&&k(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function L(){L=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var i=e&&e.prototype instanceof d?e:d,a=Object.create(i.prototype),c=new G(n||[]);return o(a,"_invoke",{value:j(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var h="suspendedStart",y="suspendedYield",p="executing",m="completed",v={};function d(){}function b(){}function g(){}var w={};l(w,a,(function(){return this}));var S=Object.getPrototypeOf,P=S&&S(S(A([])));P&&P!==r&&n.call(P,a)&&(w=P);var k=g.prototype=d.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"==C(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(u).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function j(e,r,n){var o=h;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=T(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var l=f(e,r,n);if("normal"===l.type){if(o=n.done?m:y,l.arg===v)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function T(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,T(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function G(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(C(e)+" is not iterable")}return b.prototype=g,o(k,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:b,configurable:!0}),b.displayName=l(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,l(t,s,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},E(O.prototype),l(O.prototype,c,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(k),l(k,s,"Generator"),l(k,a,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=A,G.prototype={constructor:G,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:A(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}var j=L().mark(T);function T(t,e){var r,n;return L().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return r=Math.floor(Math.random()*t.length),n=Math.floor(Math.random()*e+1),o.next=5,new t[r](n);case 5:o.next=0;break;case 7:case"end":return o.stop()}}),j)}function x(t,e,r){for(var n=new O,o=T(t,e),i=0;i<r;i++){var a=o.next().value;a&&n.add(a)}return n}function _(t){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_(t)}function G(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(G=function(){return!!t})()}function A(t){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},A(t)}function M(t,e){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},M(t,e)}var R=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=function(t,e,r){return e=A(e),function(t,e){if(e&&("object"==_(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,G()?Reflect.construct(e,r||[],A(t).constructor):e.apply(t,r))}(this,e,[t,"bowman"])).attack=25,r.defence=25,r.movement=2,r.attackRange=2,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&M(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(m);function N(t){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N(t)}function I(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(I=function(){return!!t})()}function D(t){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},D(t)}function z(t,e){return z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},z(t,e)}var U=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=function(t,e,r){return e=D(e),function(t,e){if(e&&("object"==N(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,I()?Reflect.construct(e,r||[],D(t).constructor):e.apply(t,r))}(this,e,[t,"swordsman"])).attack=40,r.defence=10,r.movement=4,r.attackRange=1,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&z(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(m);function B(t){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B(t)}function F(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(F=function(){return!!t})()}function q(t){return q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},q(t)}function H(t,e){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},H(t,e)}var Y=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=function(t,e,r){return e=q(e),function(t,e){if(e&&("object"==B(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,F()?Reflect.construct(e,r||[],q(t).constructor):e.apply(t,r))}(this,e,[t,"magician"])).attack=10,r.defence=40,r.movement=1,r.attackRange=4,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&H(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(m);function $(t){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$(t)}function J(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(J=function(){return!!t})()}function W(t){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},W(t)}function K(t,e){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},K(t,e)}var Q=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=function(t,e,r){return e=W(e),function(t,e){if(e&&("object"==$(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,J()?Reflect.construct(e,r||[],W(t).constructor):e.apply(t,r))}(this,e,[t,"vampire"])).attack=25,r.defence=25,r.movement=2,r.attackRange=2,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&K(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(m);function V(t){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V(t)}function X(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(X=function(){return!!t})()}function Z(t){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Z(t)}function tt(t,e){return tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tt(t,e)}var et=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=function(t,e,r){return e=Z(e),function(t,e){if(e&&("object"==V(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,X()?Reflect.construct(e,r||[],Z(t).constructor):e.apply(t,r))}(this,e,[t,"undead"])).attack=40,r.defence=10,r.movement=4,r.attackRange=1,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tt(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(m);function rt(t){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rt(t)}function nt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(nt=function(){return!!t})()}function ot(t){return ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ot(t)}function it(t,e){return it=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},it(t,e)}var at=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=function(t,e,r){return e=ot(e),function(t,e){if(e&&("object"==rt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,nt()?Reflect.construct(e,r||[],ot(t).constructor):e.apply(t,r))}(this,e,[t,"daemon"])).attack=10,r.defence=10,r.movement=1,r.attackRange=4,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&it(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(m);const ct="pointer",st="crosshair",lt="not-allowed";function ut(){ut=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var i=e&&e.prototype instanceof d?e:d,a=Object.create(i.prototype),c=new x(n||[]);return o(a,"_invoke",{value:C(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var h="suspendedStart",y="suspendedYield",p="executing",m="completed",v={};function d(){}function b(){}function g(){}var w={};l(w,a,(function(){return this}));var S=Object.getPrototypeOf,P=S&&S(S(_([])));P&&P!==r&&n.call(P,a)&&(w=P);var k=g.prototype=d.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"==pt(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(u).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function C(e,r,n){var o=h;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=L(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var l=f(e,r,n);if("normal"===l.type){if(o=n.done?m:y,l.arg===v)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function L(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,L(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function _(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(pt(e)+" is not iterable")}return b.prototype=g,o(k,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:b,configurable:!0}),b.displayName=l(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,l(t,s,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},E(O.prototype),l(O.prototype,c,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(k),l(k,s,"Generator"),l(k,a,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=_,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:_(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ft(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function ht(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ft(i,n,o,a,c,"next",t)}function c(t){ft(i,n,o,a,c,"throw",t)}a(void 0)}))}}function yt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function pt(t){return pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pt(t)}function mt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,vt(n.key),n)}}function vt(t){var e=function(t){if("object"!=pt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=pt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==pt(e)?e:e+""}var dt=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gamePlay=e,this.stateService=r,this.gameState=new f,this.boardSize=this.gamePlay.boardSize,this.positionedCharacters=[],this.playerTypes=[R,U,Y],this.enemyTypes=[Q,et,at],this.enemyTeam=new O,this.playerTeam=new O,this.themes=Object.keys(c)},e=[{key:"init",value:function(){this.gamePlay.drawUi(this.themes[this.gameState.level-1]);var t=this.getPositions(),e=t.playerPositions,r=t.enemyPositions;this.playerTeam=x(this.playerTypes,this.gameState.level,2),this.enemyTeam=x(this.enemyTypes,this.gameState.level,2),this.positionCharacters(e,this.playerTeam),this.positionCharacters(r,this.enemyTeam),this.gamePlay.redrawPositions(this.positionedCharacters),console.log("Positioned Characters",this.positionedCharacters),console.log("Enemy team",this.enemyTeam),this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addNewGameListener(this.onNewGameClick.bind(this)),this.gamePlay.addSaveGameListener(this.onSaveGameClick.bind(this)),this.gamePlay.addLoadGameListener(this.onLoadGameClick.bind(this))}},{key:"onCellClick",value:function(t){if(!this.gameState.isGameOver){var e=this.getCharacter(t);e?this.isPlayerCharacter(t)?(this.deselectAllCells(),this.gamePlay.selectCell(t),this.currentCharacter=e,this.gameState.selected=t):this.currentCharacter&&this.canAttack(t)?(this.deselectAllCells(),this.attack(t),this.currentCharacter=null,this.computerActions()):a.showError("Выберите своего персонажа"):this.currentCharacter&&this.canMove(t)&&(this.deselectAllCells(),this.currentCharacter.position=t,this.gamePlay.redrawPositions(this.positionedCharacters),this.currentCharacter=null,this.gameState.isPlayerTurn=!1,this.computerActions())}}},{key:"onCellEnter",value:function(t){if(!this.gameState.isGameOver){var e=this.getCharacter(t);if(e){this.gamePlay.setCursor("pointer");var r=this.formatCharacterInfo(e.character);this.gamePlay.showCellTooltip(r,t)}this.currentCharacter&&(!e&&this.canMove(t)?(this.gamePlay.setCursor(ct),this.gamePlay.selectCell(t,"green")):e&&!this.isPlayerCharacter(t)?this.canAttack(t)?(this.gamePlay.setCursor(st),this.gamePlay.selectCell(t,"red")):this.gamePlay.setCursor(lt):this.isPlayerCharacter(t)||this.gamePlay.setCursor(lt))}}},{key:"onCellLeave",value:function(t){this.gameState.isGameOver||(this.gamePlay.cells.forEach((function(t){return t.classList.remove("selected-red")})),this.gamePlay.cells.forEach((function(t){return t.classList.remove("selected-green")})),this.gamePlay.setCursor("auto"),this.gamePlay.hideCellTooltip(t),this.gamePlay.setCursor("auto"),this.gamePlay.hideCellTooltip(t))}},{key:"deselectAllCells",value:function(){var t=this;this.positionedCharacters.forEach((function(e){t.gamePlay.deselectCell(e.position)})),this.gamePlay.cells.forEach((function(t){t.classList.remove("selected-green","selected-red")}))}},{key:"getPositions",value:function(){for(var t=[],e=[],r=0;r<this.boardSize;r++)for(var n=0;n<this.boardSize;n++){var o=r*this.boardSize+n;0!==n&&1!==n||t.push(o),n!==this.boardSize-2&&n!==this.boardSize-1||e.push(o)}return{playerPositions:t,enemyPositions:e}}},{key:"formatCharacterInfo",value:function(t){return t&&"object"===pt(t)?"🎖 ".concat(t.level," ⚔ ").concat(t.attack," 🛡 ").concat(t.defence," ❤ ").concat(t.health):"Invalid character object"}},{key:"getCharacter",value:function(t){return this.positionedCharacters.find((function(e){return e.position===t}))}},{key:"isPlayerCharacter",value:function(t){if(this.getCharacter(t)){var e=this.getCharacter(t).character;return this.playerTypes.some((function(t){return e instanceof t}))}return!1}},{key:"canMove",value:function(t){if(this.currentCharacter){var e=this.currentCharacter.character.movement;return this.calcRange(this.currentCharacter.position,e).includes(t)}return!1}},{key:"canAttack",value:function(t){if(this.currentCharacter){var e=this.currentCharacter.character.attackRange;return this.calcRange(this.currentCharacter.position,e).includes(t)}return!1}},{key:"calcRange",value:function(t,e){for(var r=[],n=this.boardSize,o=Math.floor(t/n),i=t%n,a=1;a<=e;a++)o+a<n&&r.push(t+n*a),o-a>=0&&r.push(t-n*a),i-a>=0&&r.push(t-a),i+a<n&&r.push(t+a),o+a<n&&i-a>=0&&r.push(t+(n*a-a)),o+a<n&&i+a<n&&r.push(t+(n*a+a)),o-a>=0&&i-a>=0&&r.push(t-(n*a+a)),o-a>=0&&i+a<n&&r.push(t-(n*a-a));return r}},{key:"getScore",value:function(){this.gameState.score+=this.playerTeam.toArray().reduce((function(t,e){return t+e.health}),0)}},{key:"getResult",value:function(){return 0===this.playerTeam.characters.size?(this.gameState.statistics.push(this.gameState.score),void a.showMessage("Вы проиграли:( Количество очков: ".concat(this.gameState.score,"."))):0===this.enemyTeam.characters.size&&4===this.gameState.level?(this.getScore(),this.gameOver(),void this.gameState.statistics.push(this.gameState.score)):void(0===this.enemyTeam.characters.size&&this.gameState.level<=3&&(this.gameState.isPlayerTurn=!0,this.getScore(),a.showMessage("Вы прошли уровень ".concat(this.gameState.level,". Количество очков: ").concat(this.gameState.score,".")),this.gameState.level+=1,this.nextLevel()))}},{key:"nextLevel",value:function(){var t,e=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return yt(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?yt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}(this.playerTeam.characters);try{for(e.s();!(t=e.n()).done;)t.value.levelUp()}catch(t){e.e(t)}finally{e.f()}}},{key:"getLevelUp",value:function(){switch(this.positionedCharacters=[],this.gameState.level){case 1:this.gamePlay.drawUi(this.themes[this.gameState.level-1]),this.enemyTeam=x(this.enemyTypes,1,this.playerTeam.characters.size);break;case 2:this.gamePlay.drawUi(this.themes[this.gameState.level-1]),this.enemyTeam=x(this.enemyTypes,2,this.playerTeam.characters.size);break;case 3:this.gamePlay.drawUi(this.themes[this.gameState.level-1]),this.enemyTeam=x(this.enemyTypes,3,this.playerTeam.characters.size);break;case 4:this.gamePlay.drawUi(this.themes[this.gameState.level-1]),this.enemyTeam=x(this.enemyTypes,4,this.playerTeam.characters.size)}var t=this.getPositions(),e=t.playerPositions,r=t.enemyPositions;this.positionCharacters(e,this.playerTeam),this.positionCharacters(r,this.enemyTeam),this.gamePlay.redrawPositions(this.positionedCharacters)}},{key:"getDelete",value:function(t){this.positionedCharacters.splice(this.positionedCharacters.indexOf(this.getCharacter(t)),1)}},{key:"attack",value:(n=ht(ut().mark((function t(e){var r,n,o;return ut().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.gameState.isPlayerTurn){t.next=15;break}if(r=this.currentCharacter.character,n=this.getCharacter(e).character,o=Math.max(r.attack-n.defence,.1*r.attack),r&&n){t.next=7;break}return console.error("Attacker or target not found"),t.abrupt("return");case 7:return t.next=9,this.gamePlay.showDamage(e,o);case 9:n.health-=o,n.health<=0&&(this.getDelete(e),this.enemyTeam.delete(n)),0===this.enemyTeam.characters.size&&(4===this.gameState.level?this.gameOver():(this.getResult(),this.getLevelUp())),this.gamePlay.redrawPositions(this.positionedCharacters),this.gameState.isPlayerTurn=!1,this.computerActions();case 15:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"getRandom",value:function(t){return t[Math.floor(Math.random()*t.length)]}},{key:"computerActions",value:(r=ht(ut().mark((function t(){var e,r,n,o,i,a,c,s=this;return ut().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.gameState.isPlayerTurn){t.next=2;break}return t.abrupt("return");case 2:if(e=this.positionedCharacters.filter((function(t){return s.enemyTypes.some((function(e){return t.character instanceof e}))})),r=this.positionedCharacters.filter((function(t){return s.playerTypes.some((function(e){return t.character instanceof e}))})),n=null,o=null,0!==e.length&&0!==r.length){t.next=8;break}return t.abrupt("return");case 8:if(e.forEach((function(t){var e=s.calcRange(t.position,t.character.attackRange);r.forEach((function(r){e.includes(r.position)&&(n=t,o=r)}))})),!o){t.next=20;break}return i=Math.max(n.character.attack-o.character.defence,.1*n.character.attack),t.next=13,this.gamePlay.showDamage(o.position,i);case 13:o.character.health-=i,o.character.health<=0&&(this.getDelete(o.position),this.playerTeam.delete(o.character)),this.gamePlay.redrawPositions(this.positionedCharacters),this.gameState.isPlayerTurn=!0,this.getResult(),t.next=27;break;case 20:n=e[Math.floor(Math.random()*e.length)],(a=this.calcRange(n.position,n.character.movement)).forEach((function(t){s.positionedCharacters.forEach((function(e){t===e.position&&a.splice(a.indexOf(e.position),1)}))})),c=this.getRandom(a),n.position=c,this.gamePlay.redrawPositions(this.positionedCharacters),this.gameState.isPlayerTurn=!0;case 27:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"onNewGameClick",value:function(){this.gameState.isGameOver=!1,this.gameState.level=1,this.gameState.score=0,this.gamePlay.drawUi(this.themes[this.gameState.level-1]);var t=this.getPositions(),e=t.playerPositions,r=t.enemyPositions;this.playerTeam=x(this.playerTypes,1,2),this.enemyTeam=x(this.enemyTypes,1,2),this.positionedCharacters=[],this.positionCharacters(e,this.playerTeam),this.positionCharacters(r,this.enemyTeam),this.gamePlay.redrawPositions(this.positionedCharacters)}},{key:"positionCharacters",value:function(t,e){var r=this;e.characters.forEach((function(e){if(t.length>0){var n=Math.floor(Math.random()*t.length),o=t.splice(n,1)[0];r.positionedCharacters.push(new w(e,o))}}))}},{key:"onSaveGameClick",value:function(){this.gameState.allPositions=this.positionedCharacters.map((function(t){return{character:{type:t.character.constructor.name.toLowerCase(),level:t.character.level,health:t.character.health},position:t.position}})),this.stateService.save(f.from(this.gameState)),a.showMessage("Игра сохранена")}},{key:"onLoadGameClick",value:function(){var t=this,e=this.stateService.load();e?(this.gameState.isPlayerTurn=e.isPlayerTurn,this.gameState.level=e.level,this.gameState.score=e.score,this.gameState.statistics=e.statistics,this.gameState.selected=e.selected,this.playerTeam=new O,this.enemyTeam=new O,this.positionedCharacters=[],e.allPositions.forEach((function(e){var r;switch(e.character.type){case"swordsman":r=new U(e.character.level);break;case"bowman":r=new R(e.character.level);break;case"magician":r=new Y(e.character.level);break;case"undead":r=new et(e.character.level);break;case"vampire":r=new Q(e.character.level);break;case"daemon":r=new at(e.character.level);break;default:return void console.warn("Неизвестный тип персонажа: ".concat(e.character.type))}r.health=e.character.health;var n=new w(r,e.position);t.positionedCharacters.push(n),t.playerTypes.some((function(t){return r instanceof t}))?t.playerTeam.addAll([r]):t.enemyTypes.some((function(t){return r instanceof t}))&&t.enemyTeam.addAll([r])})),a.showMessage("Игра загружена"),this.gamePlay.drawUi(this.themes[this.gameState.level-1]),this.gamePlay.redrawPositions(this.positionedCharacters)):a.showError("Ошибка загрузки.")}},{key:"gameOver",value:function(){this.gameState.isGameOver=!0,this.gamePlay.setCursor("auto"),a.showMessage("Вы победили! Поздравляем! Количество очков: ".concat(this.gameState.score))}}],e&&mt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function bt(t){return bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bt(t)}function gt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,wt(n.key),n)}}function wt(t){var e=function(t){if("object"!=bt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=bt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==bt(e)?e:e+""}var St=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.storage=e},(e=[{key:"save",value:function(t){this.storage.setItem("state",JSON.stringify(t))}},{key:"load",value:function(){try{return JSON.parse(this.storage.getItem("state"))}catch(t){throw new Error("Invalid state")}}}])&&gt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}(),Pt=new a;Pt.bindToDOM(document.querySelector("#game-container")),new dt(Pt,new St(localStorage)).init()})();